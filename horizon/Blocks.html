<!doctype HTML>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="codemirror.js"></script>
<script src="runmode.js"></script>
<script src="pyret.js"></script>
<script src="hilite.js"></script>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>2.1.4&nbsp;Blocks</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="codemirror.css" title="default"/><link rel="stylesheet" type="text/css" href="pyret.css" title="default"/><link rel="stylesheet" type="text/css" href="styles.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Pyret</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Getting_Started.html" class="tocviewlink" data-pltdoc="x">Getting Started</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Language_Concepts.html" class="tocviewselflink" data-pltdoc="x">Language Concepts</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Builtins_and_Libraries.html" class="tocviewlink" data-pltdoc="x">Builtins and Libraries</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Internals.html" class="tocviewlink" data-pltdoc="x">Internals</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="Language_Concepts.html" class="tocviewlink" data-pltdoc="x">Language Concepts</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="s_forms.html" class="tocviewselflink" data-pltdoc="x">Language Constructs</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="testing.html" class="tocviewlink" data-pltdoc="x">Testing</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="equality.html" class="tocviewlink" data-pltdoc="x">equality</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="brands.html" class="tocviewlink" data-pltdoc="x">Brands</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="type-check.html" class="tocviewlink" data-pltdoc="x">Type Checking</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>2.1&nbsp;</td><td><a href="s_forms.html" class="tocviewlink" data-pltdoc="x">Language Constructs</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1.1&nbsp;</td><td><a href="s_program.html" class="tocviewlink" data-pltdoc="x">Programs</a></td></tr><tr><td align="right">2.1.2&nbsp;</td><td><a href="Import_Statements.html" class="tocviewlink" data-pltdoc="x">Import Statements</a></td></tr><tr><td align="right">2.1.3&nbsp;</td><td><a href="Provide_Statements.html" class="tocviewlink" data-pltdoc="x">Provide Statements</a></td></tr><tr><td align="right">2.1.4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Blocks</a></td></tr><tr><td align="right">2.1.5&nbsp;</td><td><a href="Statements.html" class="tocviewlink" data-pltdoc="x">Statements</a></td></tr><tr><td align="right">2.1.6&nbsp;</td><td><a href="Expressions.html" class="tocviewlink" data-pltdoc="x">Expressions</a></td></tr><tr><td align="right">2.1.7&nbsp;</td><td><a href="s_annotations.html" class="tocviewlink" data-pltdoc="x">Annotations</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_3&quot;);">&#9658;</a></td><td>2.1.4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Blocks</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_3"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1.4.1&nbsp;</td><td><a href="#%28part._s~3ablocky-blocks%29" class="tocviewlink" data-pltdoc="x">Block shorthand</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.1.4.1<tt>&nbsp;</tt></span><a href="#%28part._s~3ablocky-blocks%29" class="tocsubseclink" data-pltdoc="x">Block shorthand</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Provide_Statements.html" title="backward to &quot;2.1.3 Provide Statements&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="s_forms.html" title="up to &quot;2.1 Language Constructs&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Statements.html" title="forward to &quot;2.1.5 Statements&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h5>2.1.4<tt>&nbsp;</tt><a name="(part._.Blocks)"></a>Blocks</h5><p>A block&rsquo;s syntax is a list of statements:</p><blockquote class="SCodeFlow" style="white-space: pre;"><p><a name="(elem._(bnf-prod._(.Pyret._block)))"></a>&#8249;block&#8250;<span class="bnf-meta">:</span> <span class="bnf-meta">(</span><a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._stmt%29%29%29" data-pltdoc="x">&#8249;stmt&#8250;</a><span class="bnf-meta">)</span><span class="bnf-meta">*</span>
<a name="(elem._(bnf-prod._(.Pyret._user-block-expr)))"></a>&#8249;user-block-expr&#8250;<span class="bnf-meta">:</span> <span class="bnf-lit">block:</span> <a href="#%28elem._%28bnf-prod._%28.Pyret._block%29%29%29" data-pltdoc="x">&#8249;block&#8250;</a> <span class="bnf-lit">end</span></p></blockquote><p>Blocks serve two roles in Pyret:</p><ul><li><p>Sequencing of operations</p></li><li><p>Units of lexical scope</p></li></ul><p>The <a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._let-expr%29%29%29" data-pltdoc="x">&#8249;let-expr&#8250;</a>, <a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._fun-expr%29%29%29" data-pltdoc="x">&#8249;fun-expr&#8250;</a>,
<a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._data-expr%29%29%29" data-pltdoc="x">&#8249;data-expr&#8250;</a>, and <a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._var-expr%29%29%29" data-pltdoc="x">&#8249;var-expr&#8250;</a> forms
are handled specially and non-locally within blocks.  A detailed
description of scope will appear here soon.</p><p>Blocks evaluate each of their statements in order, and evaluate to the value of
the final statement in the block.</p><p>The <a href="#%28elem._%28bnf-prod._%28.Pyret._user-block-expr%29%29%29" data-pltdoc="x">&#8249;user-block-expr&#8250;</a> form <span style="font-style: italic">additionally</span>
creates a scope for any names bound inside it.  That is, definitions
within such a block are visible only within that block:</p><pre class="pyret-block"><pre class="pyret-highlight"><p>x = 10
ans = block:
  y = 5 + x # x is visible here
  42 # value result of the block
end
z = y + ans # error: y is not in scope here</p></pre></pre><h5>2.1.4.1<tt>&nbsp;</tt><a name="(part._s~3ablocky-blocks)"></a>Block shorthand</h5><p>Many expressions in Pyret include one or more blocks within them.  For
example, the body of a function is defined as a block.  Technically,
this means the following program is legal:</p><pre class="pyret-block"><pre class="pyret-highlight bad-ex"><p>fun weather-reaction(forecast, temp):
  ask:
    | forecast == "sunny" then: "sunglasses"
    | forecast == "rainy" then: "umbrella"
    | otherwise: ""
  end
  ask:
    | temp &gt; 85 then: "shorts"
    | temp &gt; 50 then: "jeans"
    | temp &gt; 0 then: "parka"
    | otherwise: "stay inside!"
  end
end</p></pre></pre><p>However, the program probably won&rsquo;t behave as expected: rather than
returning some combination of "sunglasses" and "shorts" for a warm,
sunny day, it will evaluate the first <span class="stt">ask</span> expression,
<span style="font-style: italic">discard the result</span>, and then evaluate the second <span class="stt">ask</span>
expression and return its result.</p><p>Pyret will warn the programmer if it encounters programs like these,
and complain that the block contains multiple expressions.  Often
as in this case, it signals a real mistake, and the programmer ought
to revise the code to comprise a single expression &#8212;<wbr></wbr> say, by
concatenating the two results above.  Sometimes, though, multiple
expressions are deliberate:</p><pre class="pyret-block"><pre class="pyret-highlight bad-ex"><p>if some-condition():
  temp = some-complicated-expression()
  print(temp) # make sure we got it right!
  do-something-with(temp)
else:
  do-something-else()
end</p></pre></pre><p>To tell Pyret that these multiple statements are intentional, we could
write an explicit <span class="stt">block</span> form:</p><pre class="pyret-block"><pre class="pyret-highlight ok-ex"><p>if some-condition():
  block:
    temp = some-complicated-expression()
    print(temp) # make sure we got it right!
    do-something-with(temp)
  end
else:
  do-something-else()
end</p></pre></pre><p>...but that is syntactically annoying for a straightforward situation!
Instead, Pyret allows for block <span style="font-style: italic">shorthands</span>: writing <span class="stt">block</span>
before the opening colon of a blocky expression signals that the
expression is deliberate.</p><pre class="pyret-block"><pre class="pyret-highlight good-ex"><p>if some-condition() block:
  temp = some-complicated-expression()
  print(temp) # make sure we got it right!
  do-something-with(temp)
else:
  do-something-else()
end</p></pre></pre><p>The leading <span class="stt">block</span> allows for multiple statements in <span style="font-style: italic">all</span> of
the blocks of this expression.  Analogous markers exist for
<a href="Expressions.html#%28elem._%28bnf-prod._%28.Pyret._ask-expr%29%29%29" data-pltdoc="x">&#8249;ask-expr&#8250;</a>, <a href="Expressions.html#%28elem._%28bnf-prod._%28.Pyret._cases-expr%29%29%29" data-pltdoc="x">&#8249;cases-expr&#8250;</a>, <a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._fun-expr%29%29%29" data-pltdoc="x">&#8249;fun-expr&#8250;</a>, etc.</p><p>However, even this marker is sometimes too much.  Suppose we
eliminated the <span class="stt">print</span> call in the example above:</p><pre class="pyret-block"><pre class="pyret-highlight"><p>if some-condition() block:
  temp = some-complicated-expression()
  do-something-with(temp)
else:
  do-something-else()
end</p></pre></pre><p>Why should this expression be penalized, but the equivalent one, where
we inline the definition of <span class="stt">temp</span>, not be?  After all, this one is
clearer to read!  In fact, Pyret will <span style="font-style: italic">not</span> complain about this
block containing multiple expressions.  Instead, Pyret will consider
the following to be valid "non-blocky" blocks:</p><blockquote class="SCodeFlow" style="white-space: pre;"><p><a name="(elem._(bnf-prod._(.Pyret._non-blocky-block)))"></a>&#8249;non-blocky-block&#8250;<span class="bnf-meta">:</span> <span class="bnf-meta">(</span><a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._stmt%29%29%29" data-pltdoc="x">&#8249;stmt&#8250;</a><span class="bnf-meta">)</span><span class="bnf-meta">*</span> <a href="Expressions.html#%28elem._%28bnf-prod._%28.Pyret._template-expr%29%29%29" data-pltdoc="x">&#8249;template-expr&#8250;</a> <span class="bnf-meta">(</span><a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._stmt%29%29%29" data-pltdoc="x">&#8249;stmt&#8250;</a><span class="bnf-meta">)</span><span class="bnf-meta">*</span><span class="bnf-meta"> | </span><span class="bnf-meta">(</span><a href="Statements.html#%28elem._%28bnf-prod._%28.Pyret._let-expr%29%29%29" data-pltdoc="x">&#8249;let-expr&#8250;</a><span class="bnf-meta">)</span><span class="bnf-meta">*</span> <a href="Expressions.html#%28elem._%28bnf-prod._%28.Pyret._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a><span class="bnf-meta"> | </span><a href="#%28elem._%28bnf-prod._%28.Pyret._user-block-expr%29%29%29" data-pltdoc="x">&#8249;user-block-expr&#8250;</a></p></blockquote><p>Any sequence of let-bindings followed by exactly one expression is
fine, as is any block containing even a single template-expression, or
(obviously) an explicit <span class="stt">block</span> expression.  All other blocks will
trigger the multiple-expressions warning and require either an
explicit block or a block-shorthand to fix.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Provide_Statements.html" title="backward to &quot;2.1.3 Provide Statements&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="s_forms.html" title="up to &quot;2.1 Language Constructs&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Statements.html" title="forward to &quot;2.1.5 Statements&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>